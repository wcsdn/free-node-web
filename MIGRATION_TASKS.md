# è¿ç§»ä»»åŠ¡æ¸…å• - Ghost Game

> åŸºäº `jx/BLL/*.cs` å’Œ `jx/DALEX/*.cs` å¯¹æ¯” `src/features/webgame/` å’Œ `workers/ghost-game/`

## ğŸ“Š è¿ç§»çŠ¶æ€æ€»è§ˆ

| å±‚çº§ | C# æ¨¡å—æ•° | å·²è¿ç§» | éƒ¨åˆ†è¿ç§» | æœªè¿ç§» |
|------|----------|--------|----------|--------|
| BLL ä¸šåŠ¡å±‚ | 27 | 13 | 10 | 4 |
| DALEX æ•°æ®å±‚ | 8 | 1 | 2 | 5 |
| **æ€»è®¡** | **35** | **14 (40%)** | **12 (34%)** | **9 (26%)** |

---

## ğŸ”´ é«˜ä¼˜å…ˆçº§ - æ ¸å¿ƒç³»ç»Ÿç¼ºå¤±

### 1. Event.cs (428KB) - æ ¸å¿ƒäº‹ä»¶ç³»ç»Ÿ
**çŠ¶æ€**: âœ… å·²è¿ç§»

**å·²å®ç°**:
- âœ… åˆ›å»º `workers/ghost-game/src/routes/event.ts` (12KB)
- âœ… å®ç°æ—¶é—´äº‹ä»¶é˜Ÿåˆ— API (`/api/event/pending`, `/api/event/:id`)
- âœ… å®ç°äº‹ä»¶å–æ¶ˆå’Œèµ„æºè¿”è¿˜
- âœ… å®ç°äº‹ä»¶åŠ é€Ÿï¼ˆæ¶ˆè€—é‡‘æ¡ï¼‰
- âœ… ç»‘å®šåˆ°ä¸»å…¥å£ `index.ts`

**åŠŸèƒ½å†…å®¹**:
- äº‹ä»¶è§¦å‘æœºåˆ¶
- äº‹ä»¶å“åº”é€»è¾‘
- æ—¶é—´äº‹ä»¶å¤„ç†
- ç©å®¶è¡Œä¸ºäº‹ä»¶

---

### 2. FightSummaryCode.cs (428KB) - æˆ˜æ–—æ€»ç»“ç 
**çŠ¶æ€**: âŒ æœªè¿ç§»

**åŠŸèƒ½å†…å®¹**:
- æˆ˜æ–—ä¼¤å®³è®¡ç®—
- æˆ˜æ–—æ—¥å¿—ç”Ÿæˆ
- æˆ˜æŠ¥æ ¼å¼å®šä¹‰
- æˆ˜æ–—å½•åƒå­˜å‚¨

**ç¼ºå¤±å½±å“**: 
- æˆ˜æ–—ç»“æœä¸å‡†ç¡®
- æˆ˜æŠ¥æ•°æ®ä¸å®Œæ•´

**ä»»åŠ¡**:
- [ ] è¿ç§»æˆ˜æ–—è®¡ç®—å…¬å¼
- [ ] å®Œå–„ `workers/ghost-game/src/routes/battle.ts`
- [ ] å®ç°è¯¦ç»†æˆ˜æŠ¥ JSON ç”Ÿæˆ
- [ ] æ·»åŠ æˆ˜æ–—å½•åƒå›æ”¾åŠŸèƒ½

---

### 3. TechnicNode é…ç½®é—®é¢˜
**çŠ¶æ€**: âœ… å·²è§£å†³

**è§£å†³æ–¹æ¡ˆ**:
- âœ… åˆ›å»º `workers/ghost-game/src/config/technics.json` (67KB, 15ä¸ªç§‘æŠ€)
- âœ… ä» BuildingInfo.xml æå– Technic æ•°æ®
- âœ… æ›´æ–° `tech.ts` ä½¿ç”¨ JSON é…ç½®
- âœ… ç§‘æŠ€æ”¯æŒç ”ç©¶å‰ç½®æ¡ä»¶ï¼ˆå»ºç­‘ç­‰çº§ã€ç§‘æŠ€ç­‰çº§ã€åŒºåŸŸè¦æ±‚ï¼‰

**åŸå§‹é—®é¢˜**: `ConfigurationManager.AppSettings["TechnicNode"]` åœ¨é…ç½®æ–‡ä»¶ä¸­æœªé…ç½®ï¼Œå¯¼è‡´ Technic æ•°æ®æ— æ³•åŠ è½½

**æ–°æ–¹æ¡ˆ**: å°† Technic é…ç½®ç›´æ¥å†™å…¥ JSON æ–‡ä»¶ï¼Œä¸ buildings.json æ ¼å¼ä¸€è‡´

---

### 6. Mission.cs (118KB) - æ—¥å¸¸ä»»åŠ¡ç³»ç»Ÿ
**çŠ¶æ€**: âœ… å·²å®Œæˆ

**å·²å®ç°**:
- âœ… åˆ›å»º `workers/ghost-game/src/routes/daily.ts` (15KB)
- âœ… ä»»åŠ¡åˆ—è¡¨ API (`/api/daily`)
- âœ… ä»»åŠ¡è¿›åº¦æ›´æ–° (`/api/daily/progress`)
- âœ… æ‰¹é‡è¿›åº¦æ›´æ–° (`/api/daily/batch-progress`)
- âœ… ä»»åŠ¡å¥–åŠ±é¢†å– (`/api/daily/:id/claim`)
- âœ… ä¸€é”®é¢†å– (`/api/daily/claim-all`)
- âœ… ä»»åŠ¡åˆ·æ–° (`/api/daily/refresh`)
- âœ… ä»»åŠ¡ç»Ÿè®¡ (`/api/daily/stats`)
- âœ… ä»»åŠ¡é…ç½®åˆå§‹åŒ–

**åŠŸèƒ½å†…å®¹**:
- æ—¥å¸¸ä»»åŠ¡åˆ—è¡¨
- ä»»åŠ¡åˆ·æ–°é€»è¾‘
- ä»»åŠ¡å®Œæˆæ¡ä»¶
- ä»»åŠ¡å¥–åŠ±å‘æ”¾

**ä»»åŠ¡ç±»å‹æ”¯æŒ**:
- ç™»å½•ã€å»ºé€ ã€å‡çº§ã€æ‹›å‹Ÿè‹±é›„ã€è®­ç»ƒè‹±é›„
- æˆ˜æ–—ã€é‡‡é›†èµ„æºã€æ¢ç´¢ã€æ­¦å°†å‡çº§

---

### 5. Mail.cs (39KB) - é‚®ä»¶ç³»ç»Ÿ
**çŠ¶æ€**: âœ… å·²å®Œæˆ

**å·²å®ç°**:
- âœ… åˆ›å»º `workers/ghost-game/src/routes/mail.ts` (11KB)
- âœ… ç³»ç»Ÿé‚®ä»¶å‘é€ï¼ˆå•å‘/å¹¿æ’­ï¼‰
- âœ… æˆ˜æ–—æŠ¥å‘Šé‚®ä»¶ (`/api/mail/battle-report`)
- âœ… å®Œæ•´é™„ä»¶é¢†å–åŠŸèƒ½ï¼ˆç‰©å“ + èµ„æºï¼‰
- âœ… é‚®ä»¶å·²è¯»/æ‰¹é‡å·²è¯»
- âœ… é‚®ä»¶åˆ é™¤/æ‰¹é‡æ¸…ç†
- âœ… æ”¯æŒé™„ä»¶ JSON æ ¼å¼

**API ç«¯ç‚¹**:
- `GET /api/mail` - é‚®ä»¶åˆ—è¡¨
- `GET /api/mail/:id` - é‚®ä»¶è¯¦æƒ…
- `POST /api/mail/send` - å‘é€é‚®ä»¶
- `POST /api/mail/system` - å‘é€ç³»ç»Ÿé‚®ä»¶
- `POST /api/mail/battle-report` - å‘é€æˆ˜æ–—æŠ¥å‘Š
- `POST /api/mail/:id/claim` - é¢†å–é™„ä»¶
- `POST /api/mail/:id/read` - æ ‡è®°å·²è¯»
- `POST /api/mail/read-all` - å…¨éƒ¨å·²è¯»
- `DELETE /api/mail/:id` - åˆ é™¤é‚®ä»¶

---

### 6. Organize.cs (50KB) - å¸®æ´¾/è”ç›Ÿç³»ç»Ÿ
**çŠ¶æ€**: âš ï¸ éƒ¨åˆ†è¿ç§»

**å½“å‰çŠ¶æ€**: 
- âœ… å‰ç«¯ `GuildPanel.tsx` å­˜åœ¨
- âœ… å‰ç«¯ `UnionPanel.tsx` å­˜åœ¨
- âŒ åç«¯ API ä¸å®Œæ•´
- âŒ å¸®æ´¾æˆ˜åŠŸèƒ½ç¼ºå¤±

**åŠŸèƒ½ç¼ºå¤±**:
- [ ] åˆ›å»ºå¸®æ´¾
- [ ] å¸®æ´¾æˆå‘˜ç®¡ç†
- [ ] å¸®æ´¾å»ºç­‘å‡çº§
- [ ] å¸®æ´¾ç§‘æŠ€ç ”ç©¶
- [ ] å¸®æ´¾ä»“åº“
- [ ] å¸®æ´¾æˆ˜äº‰
- [ ] è”ç›Ÿå¤–äº¤

---

## ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ - é‡è¦åŠŸèƒ½ç¼ºå¤±

ä»¥ä¸‹æ¨¡å—å·²åœ¨åŸºç¡€ç‰ˆæœ¬ä¸­å®ç°ï¼Œéƒ¨åˆ†åŠŸèƒ½å¾…å®Œå–„ï¼š

| æ¨¡å— | å½“å‰çŠ¶æ€ | å¾…å®Œå–„åŠŸèƒ½ |
|------|----------|------------|
| CityInterior.cs | âœ… åŸºç¡€ç‰ˆ | ç¹è£åº¦ç³»ç»Ÿã€å­å—£ç³»ç»Ÿ |
| Item.cs | âœ… 13KB | è£…å¤‡å¼ºåŒ–ã€é•¶åµŒç³»ç»Ÿ |
| Skill.cs | âœ… åŸºç¡€ç‰ˆ | æŠ€èƒ½ç»„åˆã€è¢«åŠ¨æŠ€èƒ½ |
| DefenceBuilding.cs | âœ… åŸºç¡€ç‰ˆ | é˜²å¾¡æˆ˜æ–—è”åŠ¨ |
| FightSummaryCode.cs | âš ï¸ å¾…å®Œå–„ | è¯¦ç»†æˆ˜æŠ¥ã€æˆ˜æ–—å›æ”¾ |

---

## ğŸ“‹ API ç«¯ç‚¹æ±‡æ€»

| æ¨¡å— | è·¯ç”± | ç«¯ç‚¹æ•°é‡ |
|------|------|----------|
| è§’è‰²/è®¤è¯ | `/api/character`, `/api/user` | 8 |
| åŸå¸‚ | `/api/city` | 10 |
| å»ºç­‘ | `/api/building` | 8 |
| æ­¦å°† | `/api/hero` | 10 |
| æˆ˜æ–— | `/api/battle` | 8 |
| ç§‘æŠ€ | `/api/tech` | 6 |
| ä»»åŠ¡ | `/api/task`, `/api/daily` | 12 |
| ç‰©å“ | `/api/item` | 10 |
| é‚®ä»¶ | `/api/mail` | 10 |
| å†›å›¢ | `/api/corps` | 15 |
| åœ°å›¾ | `/api/map` | 12 |
| æ•ˆæœ | `/api/effect` | 8 |
| æ´»åŠ¨ | `/api/festival`, `/api/activity` | 10 |
| å…¶ä»– | `/api/shop`, `/api/market`, `/api/arena`... | 20+ |

**æ€»è®¡ API ç«¯ç‚¹**: 150+

---

## ğŸŸ¢ å·²å®Œæˆç³»ç»Ÿ

| æ¨¡å— | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| Hero.cs | âœ… å®Œæˆ | è‹±é›„æ‹›å‹Ÿã€è®­ç»ƒã€å‡çº§ |
| Building.cs | âœ… å®Œæˆ | å»ºç­‘å»ºé€ ã€å‡çº§ |
| Fight.cs | âœ… å®Œæˆ | PVE æˆ˜æ–— |
| User.cs | âœ… å®Œæˆ | ç”¨æˆ·è®¤è¯ã€æ•°æ® |
| CityRes.cs | âœ… å®Œæˆ | åŸå¸‚èµ„æº |
| Server.cs | âœ… å®Œæˆ | æœåŠ¡å™¨é…ç½® |
| Event.cs | âœ… å®Œæˆ | æ—¶é—´äº‹ä»¶ç³»ç»Ÿ (12KB) |
| Technic é…ç½® | âœ… å®Œæˆ | technics.json (67KB, 15ä¸ªç§‘æŠ€) |
| Mail.cs | âœ… å®Œæˆ | é‚®ä»¶ç³»ç»Ÿ + é™„ä»¶ (11KB) |
| Mission.cs | âœ… å®Œæˆ | æ—¥å¸¸ä»»åŠ¡ç³»ç»Ÿ (15KB) |
| Task.cs | âœ… å®Œæˆ | ä¸»çº¿ä»»åŠ¡ç³»ç»Ÿ (17KB) |
| PersistEffect.cs | âœ… å®Œæˆ | æŒä¹…æ•ˆæœ/BUFFç³»ç»Ÿ (9KB) |
| Item.cs | âœ… å®Œæˆ | ç‰©å“ç³»ç»Ÿ (13KB) |
| Organize.cs | âœ… å®Œæˆ | å¸®æ´¾ç³»ç»Ÿ (20KB) |
| FestivalActive.cs | âœ… å®Œæˆ | èŠ‚æ—¥æ´»åŠ¨ (8KB) |
| MapUnit.cs | âœ… å®Œæˆ | åœ°å›¾ç³»ç»Ÿ (11KB) |

---

## ğŸ”§ æŠ€æœ¯å€º

### 1. ä»£ç é‡å¤
- `GetOddsItem()` è¢«è°ƒç”¨ 2 æ¬¡ï¼ˆç¬¬158ã€160è¡Œï¼‰

### 2. é…ç½®æ£€æŸ¥
- [ ] éªŒè¯æ‰€æœ‰ `ConfigurationManager.AppSettings` éƒ½æœ‰å¯¹åº”é…ç½®

---

## ğŸ“‹ è¿ç§»ä»»åŠ¡ä¼˜å…ˆçº§æ’åº

### ç¬¬ä¸€é˜¶æ®µ âœ… å·²å®Œæˆ
1. âœ… ä¿®å¤ TechnicNode é…ç½®é—®é¢˜
2. âœ… è¿ç§» Event.csï¼ˆæ—¶é—´äº‹ä»¶ï¼‰
3. âœ… å®Œå–„ Mail.csï¼ˆé™„ä»¶åŠŸèƒ½ï¼‰
4. âœ… è¿ç§» Mission.csï¼ˆæ—¥å¸¸ä»»åŠ¡ï¼‰

### ç¬¬äºŒé˜¶æ®µ âœ… å·²å®Œæˆ
5. âœ… è¿ç§» Task.csï¼ˆä¸»çº¿ä»»åŠ¡ï¼Œ17KBï¼‰
6. âœ… è¿ç§» PersistEffect.csï¼ˆæŒä¹…æ•ˆæœï¼Œ9KBï¼‰
7. âœ… å®Œå–„ Item.csï¼ˆç‰©å“ç³»ç»Ÿï¼Œ13KBï¼‰
8. âœ… å®Œå–„ Organize.csï¼ˆå¸®æ´¾ç³»ç»Ÿï¼Œ20KBï¼‰

### ç¬¬ä¸‰é˜¶æ®µ âœ… å·²å®Œæˆ
9. âœ… è¿ç§» FestivalActive.csï¼ˆèŠ‚æ—¥æ´»åŠ¨ï¼Œ8KBï¼‰
10. âœ… è¿ç§» MapUnit.csï¼ˆåœ°å›¾ç³»ç»Ÿï¼Œ11KBï¼‰
11. [ ] å®Œå–„ Skill.csï¼ˆæŠ€èƒ½ç³»ç»Ÿï¼‰
12. [ ] è¿ç§» FightSummaryCode.csï¼ˆæˆ˜æ–—è¯¦ç»†ï¼‰

---

## ğŸ“ ç›¸å…³æ–‡ä»¶

- C# å‚è€ƒ: `jx/BLL/*.cs`
- C# æ•°æ®: `jx/DALEX/*.cs`
- å‰ç«¯ç»„ä»¶: `src/features/webgame/components/`
- åç«¯è·¯ç”±: `workers/ghost-game/src/routes/`
- æ•°æ®åº“: `workers/ghost-game/schema.sql`
