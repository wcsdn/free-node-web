<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Âú∞ÁêÉËßÜÂõæ - ÊÄÅÂäøÁõëÊéß</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/globe.gl"></script>
    <style>
        .globe-page {
            display: flex;
            flex-direction: column;
            height: 100vh;
            background: #0a0a0f;
        }

        .globe-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            background: rgba(15, 15, 25, 0.95);
            border-bottom: 1px solid rgba(255, 100, 100, 0.2);
            z-index: 100;
        }

        .globe-header .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .globe-header .logo-icon {
            color: #ff4444;
            font-size: 1.5rem;
            animation: pulse-glow 2s infinite;
        }

        .globe-header .logo-text {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            font-size: 1.1rem;
            color: #fff;
            letter-spacing: 2px;
        }

        .globe-header .nav-links {
            display: flex;
            gap: 1rem;
        }

        .globe-header .nav-link {
            color: #888;
            text-decoration: none;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .globe-header .nav-link:hover,
        .globe-header .nav-link.active {
            color: #fff;
            background: rgba(255, 68, 68, 0.2);
        }

        .globe-container {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        #globe {
            width: 100%;
            height: 100%;
        }

        .globe-info-panel {
            position: absolute;
            top: 1rem;
            left: 1rem;
            background: rgba(15, 15, 25, 0.9);
            border: 1px solid rgba(255, 100, 100, 0.3);
            border-radius: 8px;
            padding: 1rem;
            max-width: 350px;
            z-index: 10;
            backdrop-filter: blur(10px);
        }

        .panel-title {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            color: #ff4444;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 0.75rem;
        }

        .location-name {
            font-family: 'Inter', sans-serif;
            font-size: 1.25rem;
            font-weight: 600;
            color: #fff;
            margin-bottom: 0.5rem;
        }

        .article-count {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            color: #888;
            margin-bottom: 1rem;
        }

        .article-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .article-list li {
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.85rem;
            color: #ccc;
            line-height: 1.4;
        }

        .article-list li:last-child {
            border-bottom: none;
        }

        .category-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.75rem;
        }

        .category-tag {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.65rem;
            padding: 0.25rem 0.5rem;
            background: rgba(255, 68, 68, 0.2);
            color: #ff6666;
            border-radius: 3px;
            text-transform: uppercase;
        }

        .globe-legend {
            position: absolute;
            bottom: 1rem;
            left: 1rem;
            right: auto;
            background: rgba(15, 15, 25, 0.95);
            border: 1px solid rgba(255, 100, 100, 0.3);
            border-radius: 8px;
            padding: 1rem;
            z-index: 11;
            backdrop-filter: blur(10px);
            max-width: 220px;
        }

        .legend-title {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.5rem;
        }

        .legend-section {
            margin-bottom: 0.75rem;
        }

        .legend-section:last-child {
            margin-bottom: 0;
        }

        .legend-items {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.7rem;
            color: #aaa;
        }

        .legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .legend-dot.high { background: #ff4444; }
        .legend-dot.medium { background: #ffaa00; }
        .legend-dot.low { background: #44ff88; }
        .legend-dot.conflict {
            background: #ff0000;
            box-shadow: 0 0 10px #ff0000;
            animation: conflict-pulse 1s infinite;
        }
        .legend-line {
            width: 20px;
            height: 2px;
            border-radius: 2px;
        }
        .legend-line.shipping {
            background: #4488ff;
        }
        .legend-line.air {
            background: rgba(68, 216, 255, 0.6);
        }
        .legend-line.satellite {
            background: rgba(170, 255, 255, 0.6);
        }

        @keyframes conflict-pulse {
            0%, 100% { box-shadow: 0 0 5px #ff0000; }
            50% { box-shadow: 0 0 15px #ff0000; }
        }

        .globe-controls {
            position: absolute;
            bottom: 1rem;
            right: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.35rem;
            align-items: flex-end;
            z-index: 10;
        }

        .globe-btn {
            background: rgba(15, 15, 25, 0.9);
            border: 1px solid rgba(255, 100, 100, 0.3);
            color: #fff;
            padding: 0.75rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.2s;
            backdrop-filter: blur(10px);
            min-width: 45px;
            text-align: center;
        }

        .globe-btn:hover {
            background: rgba(255, 68, 68, 0.3);
            border-color: #ff4444;
        }

        .globe-btn.active {
            background: rgba(255, 68, 68, 0.4);
            border-color: #ff4444;
        }

        .globe-btn small {
            display: block;
            font-size: 0.6rem;
            margin-top: 2px;
            opacity: 0.7;
        }

        .default-panel {
            color: #666;
            font-size: 0.85rem;
        }

        /* Time-lapse controls */
        .timelapse-controls {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(15, 15, 25, 0.9);
            border: 1px solid rgba(255, 100, 100, 0.3);
            border-radius: 8px;
            padding: 1rem;
            z-index: 10;
            backdrop-filter: blur(10px);
            display: none;
        }

        .timelapse-controls.show {
            display: block;
        }

        .timelapse-title {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            color: #ff4444;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.75rem;
        }

        .timelapse-time {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.5rem;
            color: #fff;
            margin-bottom: 0.5rem;
        }

        .timelapse-date {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            color: #888;
            margin-bottom: 1rem;
        }

        .timelapse-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
            margin-bottom: 0.75rem;
        }

        .timelapse-progress-bar {
            height: 100%;
            background: #ff4444;
            width: 0%;
            transition: width 0.1s linear;
        }

        .timelapse-btn {
            background: rgba(255, 68, 68, 0.2);
            border: 1px solid #ff4444;
            color: #ff4444;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            margin-right: 0.5rem;
        }

        .timelapse-btn:hover {
            background: #ff4444;
            color: #000;
        }

        @keyframes pulse-glow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <div class="globe-page">
        <!-- Header -->
        <header class="globe-header">
            <div class="logo">
                <span class="logo-icon">‚óâ</span>
                <span class="logo-text">ÊÄÅÂäøÁõëÊéß</span>
            </div>
            <div class="nav-links">
                <a href="/" class="nav-link">‰ª™Ë°®Êùø</a>
                <a href="/globe" class="nav-link active">3DÂú∞ÁêÉ</a>
            </div>
        </header>

        <!-- Globe Container -->
        <div class="globe-container">
            <div id="globe"></div>

            <!-- Info Panel -->
            <div class="globe-info-panel" id="info-panel">
                <div class="panel-title">Location Intel</div>
                <div id="panel-content">
                    <p class="default-panel">Click a marker to view articles from that location</p>
                </div>
            </div>

            <!-- Time-lapse Panel -->
            <div class="timelapse-controls" id="timelapse-panel">
                <div class="timelapse-title">Time-Lapse Mode</div>
                <div class="timelapse-time" id="timelapse-time">00:00</div>
                <div class="timelapse-date" id="timelapse-date">-</div>
                <div class="timelapse-progress">
                    <div class="timelapse-progress-bar" id="timelapse-progress"></div>
                </div>
                <button class="timelapse-btn" onclick="playTimelapse()">‚ñ∂ Play</button>
                <button class="timelapse-btn" onclick="stopTimelapse()">‚èπ Stop</button>
            </div>

            <!-- Legend -->
            <div class="globe-legend">
                <div class="legend-section">
                    <div class="legend-title">News Activity</div>
                    <div class="legend-items">
                        <div class="legend-item">
                            <span class="legend-dot high"></span>
                            <span>È´ò (20+ ÁØáÊñáÁ´†)</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-dot medium"></span>
                            <span>‰∏≠ (5-19 ÁØá)</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-dot low"></span>
                            <span>‰Ωé (1-4 ÁØá)</span>
                        </div>
                    </div>
                </div>
                <div class="legend-section">
                    <div class="legend-title">Ë¶ÜÁõñÂ±Ç</div>
                    <div class="legend-items">
                        <div class="legend-item">
                            <span class="legend-dot conflict"></span>
                            <span>Ê¥ªË∑ÉÂÜ≤Á™ÅÂå∫</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-line shipping"></span>
                            <span>Ëà™ËøêËà™Á∫ø</span>
                        </div>
                    </div>
                </div>
                <div class="legend-section">
                    <div class="legend-title">Ëà™Á©∫‰∏éÂ§™Á©∫</div>
                    <div class="legend-items">
                        <div class="legend-item">
                            <span class="legend-line air"></span>
                            <span>Á©∫‰∏≠Ëµ∞Âªä</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-line satellite"></span>
                            <span>Âç´ÊòüÊâ´Êèè</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="globe-controls">
                <button class="globe-btn" onclick="toggleAutoRotate()" title="ÂàáÊç¢ÊóãËΩ¨">
                    üîÑ<small>ÊóãËΩ¨</small>
                </button>
                <button class="globe-btn" onclick="toggleConflicts()" id="conflict-btn" title="ÂàáÊç¢ÂÜ≤Á™ÅÂå∫Âüü">
                    üí•<small>Êàò‰∫â</small>
                </button>
                <button class="globe-btn" onclick="toggleShipping()" id="shipping-btn" title="ÂàáÊç¢Ëà™ËøêËà™Á∫ø">
                    üö¢<small>Ë¥∏Êòì</small>
                </button>
                <button class="globe-btn" onclick="toggleTimelapse()" id="timelapse-btn" title="Êó∂Èó¥ËΩ¥Ê®°Âºè">
                    ‚è±Ô∏è<small>Êó∂Èó¥</small>
                </button>
                <button class="globe-btn active" onclick="toggleNews()" id="news-btn" title="ÂàáÊç¢Êñ∞ÈóªÊ†áËÆ∞">
                    üì∞<small>Êñ∞Èóª</small>
                </button>
                <button class="globe-btn active" onclick="toggleAirRoutes()" id="air-btn" title="ÂàáÊç¢Á©∫‰∏≠Ëµ∞Âªä">
                    ‚úàÔ∏è<small>Ëà™Á©∫</small>
                </button>
                <button class="globe-btn active" onclick="toggleSatellites()" id="sat-btn" title="ÂàáÊç¢Âç´ÊòüÊâ´Êèè">
                    üõ∞Ô∏è<small>Âç´Êòü</small>
                </button>
                <button class="globe-btn" onclick="resetView()" title="ÈáçÁΩÆËßÜÂõæ">
                    üè†<small>ÈáçÁΩÆ</small>
                </button>
            </div>
        </div>
    </div>

    <script>
        let globe;
        let globeData = [];
        let autoRotate = true;
        let showConflicts = true;
        let showShipping = true;
        let showAirRoutes = true;
        let showSatellites = true;
        let timelapseActive = false;
        let timelapseInterval = null;
        let showNews = true;
        let visiblePoints = [];

        // Active conflict zones with pulsing rings
        const CONFLICT_ZONES = [
            { name: 'Ukraine', lat: 48.5, lng: 35.0, intensity: 'high' },
            { name: 'Gaza', lat: 31.4, lng: 34.4, intensity: 'high' },
            { name: 'Sudan', lat: 15.5, lng: 32.5, intensity: 'high' },
            { name: 'Myanmar', lat: 21.0, lng: 96.0, intensity: 'medium' },
            { name: 'Syria', lat: 35.0, lng: 38.0, intensity: 'medium' },
            { name: 'Yemen', lat: 15.5, lng: 47.5, intensity: 'medium' },
            { name: 'Ethiopia', lat: 9.0, lng: 40.0, intensity: 'low' },
            { name: 'Haiti', lat: 19.0, lng: -72.3, intensity: 'medium' },
            { name: 'DRC', lat: -2.5, lng: 28.5, intensity: 'medium' },
        ];

        // Major shipping lanes
        const SHIPPING_LANES = [
            // Strait of Malacca
            { start: [1.2, 103.8], end: [6.0, 95.0], name: 'Strait of Malacca' },
            // Suez Canal route
            { start: [30.0, 32.5], end: [12.5, 43.5], name: 'Suez-Red Sea' },
            { start: [12.5, 43.5], end: [14.0, 50.0], name: 'Gulf of Aden' },
            // Strait of Hormuz
            { start: [26.5, 56.5], end: [24.0, 58.0], name: 'Strait of Hormuz' },
            { start: [24.0, 58.0], end: [20.0, 64.0], name: 'Arabian Sea Route' },
            // South China Sea
            { start: [22.3, 114.2], end: [10.0, 107.0], name: 'South China Sea N' },
            { start: [10.0, 107.0], end: [1.2, 103.8], name: 'South China Sea S' },
            // Panama approach
            { start: [9.0, -79.5], end: [25.0, -80.0], name: 'Panama-US' },
            { start: [9.0, -79.5], end: [-5.0, -81.0], name: 'Panama-Pacific' },
            // Atlantic routes
            { start: [40.7, -74.0], end: [51.5, -0.1], name: 'North Atlantic' },
            { start: [51.5, -0.1], end: [30.0, 32.5], name: 'Europe-Suez' },
            // Cape route (alternative to Suez)
            { start: [-34.0, 18.5], end: [14.0, 50.0], name: 'Cape Route' },
            // Taiwan Strait
            { start: [25.0, 121.5], end: [22.3, 114.2], name: 'Taiwan Strait' },
            // Bering Strait
            { start: [66.0, -169.0], end: [55.0, -160.0], name: 'Bering Strait' },
        ];

        const AIR_ROUTES = [
            { start: [40.7128, -74.0060], end: [51.5074, -0.1278], name: 'NYC ‚Üî London' },
            { start: [34.0522, -118.2437], end: [35.6762, 139.6503], name: 'LA ‚Üî Tokyo' },
            { start: [25.2048, 55.2708], end: [48.8566, 2.3522], name: 'Dubai ‚Üî Paris' },
            { start: [-23.5505, -46.6333], end: [51.5074, -0.1278], name: 'S√£o Paulo ‚Üî London' },
            { start: [1.3521, 103.8198], end: [37.7749, -122.4194], name: 'Singapore ‚Üî San Francisco' },
        ];

        const SATELLITE_PATHS = [
            { start: [80.0, -20.0], end: [-80.0, 160.0], name: 'Polar Orbit Alpha' },
            { start: [80.0, 120.0], end: [-80.0, -60.0], name: 'Polar Orbit Beta' },
            { start: [10.0, -140.0], end: [10.0, 140.0], name: 'Equatorial Sweep' },
        ];

        // Initialize globe
        async function initGlobe() {
            const response = await fetch('/api/globe-data');
            globeData = await response.json();

            globe = Globe()
                .globeImageUrl('https://unpkg.com/three-globe/example/img/earth-dark.jpg')
                .bumpImageUrl('https://unpkg.com/three-globe/example/img/earth-topology.png')
                .backgroundImageUrl('https://unpkg.com/three-globe/example/img/night-sky.png')
                .pointLat(d => d.lat)
                .pointLng(d => d.lng)
                .pointColor(d => getPointColor(d.count))
                .pointAltitude(d => Math.min(d.count / 50, 0.5))
                .pointRadius(d => Math.max(0.3, Math.min(d.count / 10, 1.5)))
                .pointLabel(d => `<b>${d.name}</b><br>${d.count} articles`)
                .onPointClick(handlePointClick)
                .atmosphereColor('#ff4444')
                .atmosphereAltitude(0.15)
                (document.getElementById('globe'));

            globe.pointOfView({ lat: 30, lng: 0, altitude: 2.5 });
            globe.controls().autoRotate = true;
            globe.controls().autoRotateSpeed = 0.5;

            // Add overlays
            addConflictZones();
            updateArcLayers();
            visiblePoints = globeData;
            updateNewsPoints();
        }

        // Get color based on article count
        function getPointColor(count) {
            if (count >= 20) return '#ff4444';
            if (count >= 5) return '#ffaa00';
            return '#44ff88';
        }

        function updateNewsPoints() {
            if (!globe) return;
            const data = showNews ? visiblePoints : [];
            globe.pointsData(data);
        }

        // Add conflict zone rings
        function addConflictZones() {
            const rings = CONFLICT_ZONES.map(zone => ({
                lat: zone.lat,
                lng: zone.lng,
                maxR: zone.intensity === 'high' ? 8 : zone.intensity === 'medium' ? 5 : 3,
                propagationSpeed: zone.intensity === 'high' ? 3 : 2,
                repeatPeriod: zone.intensity === 'high' ? 800 : 1200,
                color: zone.intensity === 'high' ? '#ff0000' : zone.intensity === 'medium' ? '#ff4400' : '#ff6600',
                name: zone.name
            }));

            globe
                .ringsData(showConflicts ? rings : [])
                .ringColor(d => d.color)
                .ringMaxRadius(d => d.maxR)
                .ringPropagationSpeed(d => d.propagationSpeed)
                .ringRepeatPeriod(d => d.repeatPeriod);
        }

        function updateArcLayers() {
            if (!globe) return;
            const arcs = [];

            if (showShipping) {
                arcs.push(...SHIPPING_LANES.map(lane => ({
                    startLat: lane.start[0],
                    startLng: lane.start[1],
                    endLat: lane.end[0],
                    endLng: lane.end[1],
                    name: lane.name,
                    type: 'shipping',
                    altitude: 0.12
                })));
            }

            if (showAirRoutes) {
                arcs.push(...AIR_ROUTES.map(route => ({
                    startLat: route.start[0],
                    startLng: route.start[1],
                    endLat: route.end[0],
                    endLng: route.end[1],
                    name: route.name,
                    type: 'air',
                    altitude: 0.25
                })));
            }

            if (showSatellites) {
                arcs.push(...SATELLITE_PATHS.map(path => ({
                    startLat: path.start[0],
                    startLng: path.start[1],
                    endLat: path.end[0],
                    endLng: path.end[1],
                    name: path.name,
                    type: 'satellite',
                    altitude: 0.35
                })));
            }

            if (arcs.length === 0) {
                globe.arcsData([]);
                return;
            }

            globe
                .arcsData(arcs)
                .arcColor(d => d.type === 'satellite'
                    ? 'rgba(170, 255, 255, 0.7)'
                    : d.type === 'air'
                        ? 'rgba(68, 216, 255, 0.6)'
                        : 'rgba(68, 136, 255, 0.6)')
                .arcDashLength(d => d.type === 'satellite' ? 0.6 : 0.4)
                .arcDashGap(0.2)
                .arcDashAnimateTime(d => d.type === 'satellite' ? 4000 : 3000)
                .arcStroke(d => d.type === 'satellite' ? 0.7 : d.type === 'air' ? 0.6 : 0.5)
                .arcAltitude(d => d.altitude)
                .arcLabel(d => d.name);
        }

        function toggleNews() {
            showNews = !showNews;
            document.getElementById('news-btn').classList.toggle('active', showNews);
            updateNewsPoints();
        }

        function toggleAirRoutes() {
            showAirRoutes = !showAirRoutes;
            document.getElementById('air-btn').classList.toggle('active', showAirRoutes);
            updateArcLayers();
        }

        function toggleSatellites() {
            showSatellites = !showSatellites;
            document.getElementById('sat-btn').classList.toggle('active', showSatellites);
            updateArcLayers();
        }

        // Toggle conflict zones
        function toggleConflicts() {
            showConflicts = !showConflicts;
            document.getElementById('conflict-btn').classList.toggle('active', showConflicts);
            addConflictZones();
        }

        // Toggle shipping lanes
        function toggleShipping() {
            showShipping = !showShipping;
            document.getElementById('shipping-btn').classList.toggle('active', showShipping);
            updateArcLayers();
        }

        // Handle point click
        function handlePointClick(point) {
            const panel = document.getElementById('panel-content');

            const articlesHtml = point.titles
                .map(title => `<li>${title}</li>`)
                .join('');

            const categoriesHtml = point.categories
                .map(cat => `<span class="category-tag">${cat}</span>`)
                .join('');

            panel.innerHTML = `
                <div class="location-name">${point.name}</div>
                <div class="article-count">ËøΩË∏™Âà∞ ${point.count} ÁØáÊñáÁ´†</div>
                <ul class="article-list">${articlesHtml}</ul>
                <div class="category-tags">${categoriesHtml}</div>
            `;

            globe.pointOfView({
                lat: point.lat,
                lng: point.lng,
                altitude: 1.5
            }, 1000);
        }

        // Toggle auto-rotate
        function toggleAutoRotate() {
            autoRotate = !autoRotate;
            globe.controls().autoRotate = autoRotate;
        }

        // Reset view
        function resetView() {
            globe.pointOfView({ lat: 30, lng: 0, altitude: 2.5 }, 1000);
            document.getElementById('panel-content').innerHTML =
                '<p class="default-panel">ÁÇπÂáªÊ†áËÆ∞Êü•ÁúãËØ•‰ΩçÁΩÆÁöÑÊñáÁ´†</p>';
        }

        // Time-lapse functions
        function toggleTimelapse() {
            const panel = document.getElementById('timelapse-panel');
            const btn = document.getElementById('timelapse-btn');
            timelapseActive = !timelapseActive;

            panel.classList.toggle('show', timelapseActive);
            btn.classList.toggle('active', timelapseActive);

            if (!timelapseActive) {
                stopTimelapse();
                // Restore all points
                visiblePoints = globeData;
                updateNewsPoints();
            }
        }

        function playTimelapse() {
            if (timelapseInterval) return;

            let progress = 0;
            const duration = 24; // 24 hours
            const stepMs = 100; // Update every 100ms
            const steps = 240; // Total steps

            visiblePoints = [];
            updateNewsPoints();

            timelapseInterval = setInterval(() => {
                progress++;
                const percentage = (progress / steps) * 100;
                const hours = Math.floor((progress / steps) * duration);
                const mins = Math.floor(((progress / steps) * duration * 60) % 60);

                document.getElementById('timelapse-progress').style.width = percentage + '%';
                document.getElementById('timelapse-time').textContent =
                    `${hours.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}`;
                document.getElementById('timelapse-date').textContent = 'ËøáÂéª24Â∞èÊó∂';

                // Progressively add points based on "time"
                visiblePoints = globeData.slice(0, Math.floor((progress / steps) * globeData.length));
                updateNewsPoints();

                if (progress >= steps) {
                    stopTimelapse();
                }
            }, stepMs);
        }

        function stopTimelapse() {
            if (timelapseInterval) {
                clearInterval(timelapseInterval);
                timelapseInterval = null;
            }
            document.getElementById('timelapse-progress').style.width = '100%';
            visiblePoints = globeData;
            updateNewsPoints();
        }

        // Initialize
        initGlobe();

        // Set initial button states
        document.getElementById('conflict-btn').classList.add('active');
        document.getElementById('shipping-btn').classList.add('active');
        document.getElementById('news-btn').classList.add('active');
        document.getElementById('air-btn').classList.add('active');
        document.getElementById('sat-btn').classList.add('active');
    </script>
</body>
</html>
