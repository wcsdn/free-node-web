# MEMORY.md - é•¿æœŸè®°å¿†

## é¡¹ç›®å…³é”®ä¿¡æ¯

### é¡¹ç›®ç»“æ„
```
free-node-web/
â”œâ”€â”€ jx/                          # åŸå§‹ C# ASP.NET é¡¹ç›® (å‚è€ƒ)
â”œâ”€â”€ src/features/webgame/        # React å‰ç«¯
â”œâ”€â”€ workers/ghost-game/          # Cloudflare Workers åç«¯
â”œâ”€â”€ SKILL.md                     # â­ è¿ç§»æŠ€èƒ½æŒ‡å—
â”œâ”€â”€ QUICKREF.md                  # â­ å¼€å‘é€ŸæŸ¥å¡
â””â”€â”€ memory/                      # æ¯æ—¥ä¼šè¯è®°å½•
```

---

## é‡è¦æ–‡æ¡£ (æ¯æ¬¡ä¼šè¯å¿…è¯»!)

```
âš ï¸ é‡è¦: æ–°ä¼šè¯å¼€å§‹æ—¶å¿…é¡»è¯»å–ä»¥ä¸‹æ–‡ä»¶!

1. SKILL.md          - è¿ç§»æŠ€èƒ½å®Œæ•´æŒ‡å—
   ä½ç½®: é¡¹ç›®æ ¹ç›®å½•
   
2. QUICKREF.md       - å¼€å‘é€ŸæŸ¥å¡
   ä½ç½®: é¡¹ç›®æ ¹ç›®å½•
   
3. memory/YYYY-MM-DD.md - æœ€è¿‘çš„å¼€å‘è®°å½•
   ä½ç½®: memory/ ç›®å½•

4. PROJECT_STATUS.md - é¡¹ç›®è¿›åº¦å’Œä¼˜å…ˆçº§
   ä½ç½®: é¡¹ç›®æ ¹ç›®å½•
```

---

## æ ¸å¿ƒæŠ€èƒ½è¦ç‚¹

### 1. å‰åç«¯æ¥å£ä¸€è‡´æ€§ (æœ€é‡è¦!)
```typescript
// å­—æ®µåå¿…é¡»å®Œå…¨ä¸€è‡´!
åç«¯è¿”å›: { id, name, level, max_hp }
å‰ç«¯æœŸæœ›: { id, name, level, max_hp }  // âœ… ä¸€è‡´

// ç«¯ç‚¹å¿…é¡»å®Œå…¨ä¸€è‡´!
åç«¯: POST /api/hero/list
å‰ç«¯: POST /api/hero/list  // âœ… ä¸€è‡´
```

### 2. è‡ªåŠ¨æ³¨å†Œæ¨¡å¼
```typescript
// ç”¨æˆ·é¦–æ¬¡è®¿é—®è‡ªåŠ¨åˆ›å»ºè§’è‰²å’ŒåŸå¸‚
app.post('/user-info', async (c) => {
  const result = await ensureUserAndCity(db, wallet);
  if (!result) return error(c, 'è‡ªåŠ¨æ³¨å†Œå¤±è´¥');
  return success(c, { ...userData });
});
```

### 3. æ•°æ®åº“è®¿é—®æ¨¡å¼
```typescript
// ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢é˜²æ­¢ SQL æ³¨å…¥
await db.prepare('SELECT * FROM heroes WHERE wallet_address = ?')
  .bind(walletAddress);
```

### 4. å…¨å±€å‡½æ•°æŒ‚è½½
```typescript
// åœ¨ PopupManager.tsx ä¸­æŒ‚è½½
window.OpenPage(pageId);    // æ‰“å¼€é¡µé¢
window.OpenHero();          // æ‰“å¼€æ­¦å°†é¢æ¿
window.OpenMall();          // æ‰“å¼€å•†åŸ
// ç­‰...
```

---

## æµ‹è¯•è´¦å·

| ç”¨é€” | è´¦å·/åœ°å€ | ç­¾å |
|------|----------|------|
| æµ‹è¯•é’±åŒ… | `0x1234567890abcdef1234567890abcdef12345678` | `test_signature` |

---

## æœåŠ¡å™¨åœ°å€

| ç¯å¢ƒ | åœ°å€ |
|------|------|
| å‰ç«¯å¼€å‘ | http://localhost:5174/jxweb-test |
| åç«¯å¼€å‘ | http://localhost:8788 |
| ç”Ÿäº§å‰ç«¯ | https://free-node.xyz/jxweb-test |
| ç”Ÿäº§åç«¯ | https://game.free-node.xyz |

---

## æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯ | è¯´æ˜ |
|------|------|------|
| å‰ç«¯æ¡†æ¶ | React 18 | UI ç»„ä»¶ |
| å‰ç«¯è¯­è¨€ | TypeScript | ç±»å‹å®‰å…¨ |
| æ„å»ºå·¥å…· | Vite | å¼€å‘æœåŠ¡å™¨ |
| åç«¯æ¡†æ¶ | Cloudflare Workers | æ— æœåŠ¡å™¨å‡½æ•° |
| æ•°æ®åº“ | D1 | SQLite å…¼å®¹ |
| éƒ¨ç½²å¹³å° | Cloudflare Pages + Workers | è¾¹ç¼˜è®¡ç®— |

---

## å¸¸ç”¨å‘½ä»¤

```bash
# å‰ç«¯
npm run dev                    # å¯åŠ¨å‰ç«¯å¼€å‘

# åç«¯
cd workers/ghost-game
npm run dev                    # å¯åŠ¨åç«¯

# æ•°æ®åº“
npm run db:init:local          # åˆå§‹åŒ–æœ¬åœ° D1

# æ„å»º
npm run build                  # æ„å»ºå‰ç«¯
```

---

## é¡¹ç›®è¿›åº¦

| é˜¶æ®µ | çŠ¶æ€ | å®Œæˆåº¦ |
|------|------|--------|
| åŸºç¡€æ¶æ„ | âœ… å®Œæˆ | 100% |
| è®¤è¯ç³»ç»Ÿ | âœ… å®Œæˆ | 100% |
| è‡ªåŠ¨æ³¨å†Œ | âœ… å®Œæˆ | 100% |
| åŸå¸‚ç³»ç»Ÿ | âœ… å®Œæˆ | 100% |
| æ­¦å°†ç³»ç»Ÿ | âœ… å®Œæˆ | 100% |
| å»ºç­‘ç³»ç»Ÿ | âœ… å®Œæˆ | 100% |
| å†›å›¢ç³»ç»Ÿ | ğŸ”„ è¿›è¡Œä¸­ | 80% |
| æˆ˜æ–—ç³»ç»Ÿ | â¬œ å¾…å¼€å§‹ | 0% |
| ä»»åŠ¡ç³»ç»Ÿ | â¬œ å¾…å¼€å§‹ | 0% |
| é‚®ä»¶ç³»ç»Ÿ | â¬œ å¾…å¼€å§‹ | 0% |
| å•†åŸ/å¸‚åœº | â¬œ å¾…å¼€å§‹ | 0% |
| æ’è¡Œæ¦œ/ç«æŠ€ | â¬œ å¾…å¼€å§‹ | 0% |

---

## å¸¸è§é—®é¢˜

### Q: "City not found" é”™è¯¯
**A**: ç¡®ä¿è°ƒç”¨äº†è‡ªåŠ¨æ³¨å†Œæ¥å£ `/api/game/user-info`

### Q: æ­¦å°†æ•°æ®ä¸æ˜¾ç¤º
**A**: æ£€æŸ¥æ¥å£ä¸€è‡´æ€§: å­—æ®µåå¿…é¡»åŒ¹é… `api-contract.ts` å®šä¹‰

### Q: æŒ‰é’®ç‚¹å‡»æ²¡ååº”
**A**: æ£€æŸ¥å…¨å±€å‡½æ•°æ˜¯å¦æ­£ç¡®æŒ‚è½½ `window.OpenXxx()`

### Q: åç«¯è¿”å› 500
**A**: æ£€æŸ¥æ•°æ®åº“æ˜¯å¦åˆå§‹åŒ–ï¼ŒæŸ¥çœ‹ Wrangler æ—¥å¿—

---

## å…³é”®æ–‡ä»¶ç´¢å¼•

| æ–‡ä»¶ | ç”¨é€” |
|------|------|
| `jx/BLL/*.cs` | åŸç‰ˆä¸šåŠ¡é€»è¾‘ (å‚è€ƒ) |
| `jx/Model/*.cs` | åŸç‰ˆæ•°æ®æ¨¡å‹ (å‚è€ƒ) |
| `workers/ghost-game/src/routes/*.ts` | åç«¯ API |
| `src/features/webgame/components/*.tsx` | å‰ç«¯ç»„ä»¶ |
| `src/features/webgame/services/gameApi.ts` | å‰ç«¯ API æœåŠ¡ |
| `src/features/webgame/types/api-contract.ts` | æ¥å£å¥‘çº¦ (å‰åç«¯ä¸€è‡´æ€§!) |
| `workers/ghost-game/schema.sql` | æ•°æ®åº“ schema |
| `workers/ghost-game/seed.sql` | æµ‹è¯•æ•°æ® |

---

## ä¼šè¯ä¹ æƒ¯

```
âœ… æ¯æ¬¡ä¼šè¯å¼€å§‹æ—¶:
   1. è¯»å– SKILL.md (è¿ç§»æŠ€èƒ½)
   2. è¯»å– QUICKREF.md (é€ŸæŸ¥)
   3. è¯»å– memory/YYYY-MM-DD.md (æœ€è¿‘è®°å½•)
   4. è¯»å– PROJECT_STATUS.md (è¿›åº¦)

âœ… æ¯æ¬¡ä¼šè¯ç»“æŸæ—¶:
   1. æ›´æ–° memory/YYYY-MM-DD.md (è®°å½•å®Œæˆçš„å·¥ä½œ)
   2. å¦‚æœæœ‰é‡è¦å†³ç­–ï¼Œæ›´æ–° MEMORY.md
   3. å¦‚æœåˆ›å»ºäº†æ–°æŠ€èƒ½ï¼Œæ›´æ–° SKILL.md
```

---

## æ›´æ–°æ—¥å¿—

### 2026-02-05
- åˆ›å»º SKILL.md (è¿ç§»æŠ€èƒ½å®Œæ•´æŒ‡å—)
- åˆ›å»º QUICKREF.md (å¼€å‘é€ŸæŸ¥å¡)
- åˆ›å»º MEMORY.md (é•¿æœŸè®°å¿†)
- å¼ºè°ƒå‰åç«¯æ¥å£ä¸€è‡´æ€§é‡è¦æ€§
